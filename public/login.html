<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log In</title>
</head>
<body>
    <h1>Log in</h1>
    <a href="/index.html">Home</a>
    <!-- <script src ="js/login.js"></script> Js file -->
    <nav>
        <ul>
            <li>
                <a href="/index.html">Home</a>
            </li>
            <li>
                <a href="/new-posts.html">Posts</a>
            </li>
            <li>
                <a href="/login.html">Log In</a>
            </li>
        </ul>
    </nav>
  
    <!---Display Result-->
 <div id ="errorMsg">
 </div>

    <form id ="login" name="login"> <!-- TODO: Add username address input -->
         <label for ="username">Enter username</label>
        <input id="username" type="text" name="username" autofocus>
        <!-- TODO: Add password address input -->
        <label for ="password">Enter password</label>
        <input id="password" type="password" name="password" autofocus>
        <!-- TODO: Add submit button -->
        <input type="submit" value="Login"/>
    </form>

    <script type="text/javascript">

function callApi(data) 
{ 
    let url="/api/login" 
    let options = {
    method: "POST",
    
    headers:{
        "Content-Type":"application/json"
    },
    body:JSON.stringify(data)
}



return fetch(url,options).then
(response => response.json()

)}

// .then(function(result){            //get a response
//     result.json().then(result => { //convert to JSON
//         console.log(result); //Print it out
        

//         //log user in 
//         if(result && result.token){
//             window.sessionStorage.setItem('token', result.token)
//             window.sessionStorage.setItem('username', result.username)
//             window.location = '/'        }

//     }
//     )
// }

// )
//get username and pass to send to the API
let form = document.getElementById("login");
let LoginError = document.getElementById("errorMsg"); //send error msg
//check to see if login is correct. 

let username =  document.getElementById("username");
let password = document.getElementById("password");



form.addEventListener("submit", (event) => { 
	event.preventDefault();      // stop the sumbit button

//gets url 
function apiGetRequest(url){
    return fetch(url).then(
        response => response.json()
    )
}


let formdata = new FormData(form);
let username  = formdata.get("username");
let password = formdata.get("password"); //send to api


//apend it the url 
let data = {
    username: username,
    password: password
}

//username and password
callApi(data).then(response => {
   
    
    
    console.log(response);
    if(response) {  //login
 
        window.location = 'http://localhost:3000/new-posts.html' //login succesful 
    }
    else{
        //output error message 
        LoginError.insertAdjacentHTML("beforeend","<p>Username or password is invalid.<p>Please try again</p>");
    }
})
})
    </script>
</body>
</html>